<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="order-page.css">
    <title>Document</title>
</head>
<body> 
    <div class="home">
        <header>
            <div class="logo">
                <span>Caffinity</span>
            </div>
            <div class="header-text">
                <h2 id="masa-adi"></h2>
                <p>Dilediğin her şey burada</p>
            </div>
        </header>
        <script>
            const selectedMasa = localStorage.getItem("selectedMasa");
            const masaAdi = document.getElementById("masa-adi");
            if (selectedMasa) {
                masaAdi.textContent = `${selectedMasa}`;
            }
        </script>

        <div class="alt-bolum">
            <div class="sol-sutun">
                <div class="left-menu">
                    <span class="material-symbols-outlined">home</span>
                </div>
            </div>

            <div class="orta-sutun">
                    <div class="middle-btn">
                        <button>Sıcaklar</button>
                        <button>Soğuklar</button>
                        <button>Pasta</button>
                        <button>Yemekler</button>
                        <button>Kahveler</button>
                    </div>
                <div class="orta-urun">
                    <div class="urunler">
                    </div>
                </div>
            </div>
            <div class="sag-sutun">
                <div class="current-order">
                    <h2>Current Order</h2>
                </div>
                <div class="seçilenler">
                    
                </div>
                <div class="fiyat">
                    <div>
                        <span>Tutar:</span>
                        <span>248 $</span>
                    </div>
                    <button>
                        ÖDEME AL
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
       fetch('https://caffinity.herokuapp.com/api/v1/items/getItems')
            .then(response => response.json())
            .then(data => {
                console.log(data.data);
                const urunler = document.querySelector(".urunler");
                const secilenUrunler = document.querySelector(".seçilenler");
                const masaAdi = document.getElementById("masa-adi").textContent;

                fetch(`https://caffinity.herokuapp.com/api/v1/tables/getTable?tableName=${masaAdi}`)
                    .then(response => response.json())
                    .then(data => {
                        const orders = data.data[0].orders;
                        if (orders.length > 0) {
                            console.log(orders);
                            for (let i = 0; i < orders.length; i++) {
                                const orderId = orders[i];
                                fetch(`https://caffinity.herokuapp.com/api/v1/orders/getOrder?orderId=${orderId}`)
                                    .then(response => response.json())
                                    .then(data => console.log(data))
                                    .catch(error => console.error(error));
                            }
                        } else {
                            alert("Henüz sipariş verilmedi");
                        }

                    })
                    .catch(error => console.error(error));

                for (let i = 0; i < data.data.length; i++) {
                    const urun = document.createElement("div");
                    urun.className = "ürün";
                    urun.innerHTML = `
                <h3>${data.data[i].product}</h3>
                <p>$${data.data[i].price}</p>
                <button class="urun-button" data-product="${data.data[i].product}" data-category="${data.data[i].category}">Ekle</button>`;
                    urunler.appendChild(urun);
                }

                const urunButtons = document.querySelectorAll(".urun-button");
                urunButtons.forEach(button => {
                    button.addEventListener("click", (event) => {
                        const product = event.target.dataset.product;
                        const category = event.target.dataset.category;
                        const price = data.data.find(item => item.product === product).price;
                        const urunHtml = `
                    <div class="seçilen-ürün">
                        <div class="product-picture">
                            <img src="coffee-2439981.jpg" alt="${product}">
                        </div>
                        <div class="product-text">
                            <div class="product-name">
                                <h2>${product}</h2>
                            </div>
                            <div class="product-info">
                                <span>${price}$</span>
                                <div class="product-buton">
                                    <button>+</button><button>-</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                        secilenUrunler.innerHTML += urunHtml;
                    });
                });
            })
            .catch(error => console.error(error));

            
            

    </script>
</body>
</html>